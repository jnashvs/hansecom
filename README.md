# 🚀 Hansecom Project - Local Setup with Docker v2

Welcome to the **Hansecom** project! This guide will help you quickly set up the entire development environment using **Docker**.

---

## ✅ Requirements

Before getting started, make sure you have the following installed on your machine:

- [Docker](https://www.docker.com/products/docker-desktop)
- [Docker Compose](https://docs.docker.com/compose/)
- [Git](https://git-scm.com/)

---

## 📥 Clone the Project

```bash
git clone https://github.com/jnashvs/hansecom.git
cd hansecom
```

---

## 🌐 Create the Docker Network (only once)

The project uses an external Docker network called `hanse-laravel-network`. If it doesn't exist yet, create it with:

```bash
docker network create hanse-laravel-network
```

---

## 🐳 Start the Containers with Docker Compose

To build and start all services:

```bash
docker-compose up --build -d
```

This command will start the following services:

- MariaDB (port `3307`)
- phpMyAdmin (port `8083`)
- Mailhog (port `8026`)
- RabbitMQ (port `15672`)
- Laravel API (port `8084`)
- Vue Frontend (port `8085`)

---

## ⚙️ Laravel Configuration

1. Access the Laravel API container:

```bash
docker exec -it $(docker ps -qf "name=laravel-api") bash
```

2. Inside the container, run the following commands:

```bash
cp .env.example .env
composer install
php artisan key:generate
php artisan migrate
php artisan db:seed
php artisan jwt:secret # then make sure the .env is using the same generated token
```

---

## 📦 Install Frontend (Vue) Dependencies

This is already automated in `docker-compose`, but if you want to manually access the container:

```bash
docker exec -it $(docker ps -qf "name=vue-frontend") bash
npm install
npm run dev -- --host 0.0.0.0 --port 8080
cp .env.example .env
```

---

## 🔗 Endpoints and Services

| Service         | URL                          | Description                                      |
|------------------|-------------------------------|--------------------------------------------------|
| Laravel API      | http://localhost:8084         | Application backend                              |
| Vue Frontend     | http://localhost:8085         | Frontend (SPA)                                   |
| phpMyAdmin       | http://localhost:8083         | Database interface                               |
| Mailhog          | http://localhost:8026         | View sent emails                                 |
| RabbitMQ         | http://localhost:15672        | Queue manager (username: guest; password: guest) |


- https://www.alphavantage.co - limit of 25 requests per day: stay alert and don't make too many request when testing it

---

## 📂 Project Structure

```
hansecom/
├── api/               # Laravel API
├── frontend/          # Vue.js frontend
├── db/                # Persistent database data
├── docker-compose.yml # Main Docker file
└── Stock API.postman_collection.json          # Postman Collection to be imported - make sure the base url is properly setup
└── README.md          # This file :)
```

---

## ⚙️ Laravel .env

Ensure your `.env` contains the correct variables:

## the RABBITMQ variable is already on .env.example. if you dont mind you can use the one I already created

```env
APP_NAME=Hansecom
APP_ENV=local
APP_KEY= (generated by artisan key:generate)
APP_DEBUG=true
APP_URL=http://localhost:8084

DB_CONNECTION=mysql
DB_HOST=mariadb-hanse
DB_PORT=3306
DB_DATABASE=hanse_db
DB_USERNAME=db_hanse_user
DB_PASSWORD=

QUEUE_CONNECTION=rabbitmq
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
RABBITMQ_VHOST=/
RABBITMQ_QUEUE=emails
```

---

## How to run the test (example: Unit tests)
```bash
touch database/testing.sqlite      # create the sqlite database (optional in case it does not exist)
php artisan migrate --env=testing  # Run migrations before your test suite starts
php artisan test                   # Run your test suite
```

## How to login in the system
Email: default@example.com
Password: password

## 🧪 Useful Commands

### Laravel

```bash
php artisan migrate          # Run migrations
php artisan db:seed          # Seed example data (optional)
php artisan test             # Run tests
php artisan queue:work --queue=emails       # Start queue worker to test rabbitmq
```

### Docker

```bash
docker-compose up -d        # Start containers in background
docker-compose down         # Stop containers
docker-compose down -v      # Stop and remove volumes
docker-compose ps           # List active containers
docker exec -it <container> bash  # Enter a container
```

---

## 🐞 Common Issues

| Issue                                 | Solution                                                                 |
|--------------------------------------|--------------------------------------------------------------------------|
| Laravel can't connect to the database | Ensure `DB_HOST=mariadb-hanse` and Docker network is created              |
| Frontend doesn't start                | It may take a while on the first build. Check Vue container logs         |
| No emails in Mailhog                  | Make sure Laravel is configured to send to `mailhog-hanse:1025`          |
| RabbitMQ fails                        | Check if `rabbitmq-hanse` service is running                             |

---

## 🧹 Full Cleanup (if you want to reset everything)

```bash
docker-compose down -v --remove-orphans
docker system prune -af
```

---

## 📬 Support

For questions, issues or suggestions, open an [issue on GitHub](https://github.com/jnashvs/hansecom/issues) or contact the technical team directly: jnashvs@gmail.com

---

## 📜 License

This project is licensed under the terms defined in the repository. See the `LICENSE` file (if available).